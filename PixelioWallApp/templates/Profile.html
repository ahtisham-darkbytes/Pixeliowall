{% extends "base.html" %} {% load static %} {% block content %}

<!-- Profile Section -->
<div class="profile-container">
  <!-- User Details -->
  <div class="profile-details">
    <h2>My Profile</h2>
 <form method="post" enctype="multipart/form-data">
  {% csrf_token %}

  <!-- Name fields -->
  <label for="first_name">First Name</label>
  <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}">

  <label for="last_name">Last Name</label>
  <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}">

  <!-- Email (readonly) -->
  <label>Email</label>
  <input type="email" value="{{ user.email }}" readonly>

  <!-- Profile Picture -->
  <div class="profile-upload">
    <label class="upload-label">Profile Picture</label>

    <input type="file" id="profile-pic" name="profile_picture" accept="image/*" hidden>
    <label for="profile-pic" class="custom-file-upload">
      <i class="fa fa-upload"></i> Change Profile Picture
    </label>

    <!-- Preview -->
    <div class="preview" id="preview-box" style="margin-top: 1rem; text-align: center">
      <img id="preview-img" src="{{ user.profile_picture.url }}" alt="Current Profile" width="120">
      <p id="file-name"></p>
    </div>
  </div>

  <button type="submit" class="btn-generic btn-updateprofile button-filled">
    Update Profile
  </button>
</form>
  </div>

  <!-- Downloaded Items -->
  <div class="downloads">
    <h2>Purchased Images</h2>
    <div class="download-grid">
      <div class="download-item">
        <img src="{%static 'images/travel.webp' %}" alt="Downloaded Item" />
        <p>Mountain Landscape</p>
      </div>
      <div class="download-item">
        <img src="{%static 'images/5.webp' %}" alt="Downloaded Item" />
        <p>Beach Sunset</p>
      </div>
      <div class="download-item">
        <img src="{%static 'images/art.webp' %}" alt="Downloaded Item" />
        <p>City Skyline</p>
      </div>
      {% comment %}
      <div class="download-item">
        <img src="{%static 'images/desert.webp' %}" alt="Downloaded Item" />
        <p>Forest Path</p>
      </div>
      {% endcomment %}
    </div>
  </div>
</div>

{% endblock %} {% block extra_scripts %}
<script>
const fileInput = document.getElementById("profile-pic");
const previewBox = document.getElementById("preview-box");
const previewImg = document.getElementById("preview-img");
const fileNameText = document.getElementById("file-name");

fileInput.addEventListener("change", function () {
  if (this.files[0]) {
    fileNameText.textContent = this.files[0].name;
    previewBox.style.display = "block";
    const reader = new FileReader();
    reader.onload = function (e) {
      previewImg.src = e.target.result;
    };
    reader.readAsDataURL(this.files[0]);
  } else {
    previewBox.style.display = "none";
    previewImg.src = "";
    fileNameText.textContent = "";
  }
});

// Toast notification logic (success/error)
function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;

    let bgColor = '#2ed573';
    if (type === 'error' || message.toLowerCase().includes('error')) {
      bgColor = '#ff4757';
    }
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${bgColor};
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      z-index: 10000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateX(100%);
      transition: transform 0.3s ease;
    `;

    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);

    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// Show Django messages as toast notifications
document.addEventListener('DOMContentLoaded', function() {
  const djangoMessages = document.querySelectorAll('.messages .alert, .messages .error, .messages .success');
  djangoMessages.forEach(function(msg) {
    let type = 'success';
    if (msg.classList.contains('error') || msg.classList.contains('alert-danger')) type = 'error';
    showNotification(msg.textContent, type);
  });

  // If Django messages are not rendered as .messages, check for context variable
  {% if messages %}
    {% for message in messages %}
      showNotification("{{ message|escapejs }}", "{{ message.tags|default:'success' }}");
    {% endfor %}
  {% endif %}
});
</script>
{% endblock %}
