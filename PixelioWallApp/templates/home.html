{% extends "base.html" %} 
{% load static %} 
{% block title %} Pixeliowall - Home{% endblock %}
{% block content %}
<!-- Hero Section -->
<section class="hero-section">
  <div class="container">
    <div class="hero-content">
      <h1 class="hero-title">
        Enter the world of Pixeliowall, where imagination becomes digital
        reality.
      </h1>
      <p class="hero-subtitle">
        Explore high-quality Images and wallpapers that awaken creativity and
        redefine your visual experience.
      </p>

      <form class="search-form" id="searchForm">
        <div class="search-container">
          <input
            type="text"
            id="searchInput"
            placeholder="Search for photos"
            class="search-input"
          />
          <button type="submit" class="search-btn">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </button>
        </div>
      </form>

      <div class="trending">
        <p class="trending-label">Trending:</p>
        <div class="trending-tags">
          <button class="trending-tag">AI Generated</button>
          <button class="trending-tag">Wallpapers</button>
          <button class="trending-tag">Sci-Fi</button>
          <button class="trending-tag">Technology</button>
          <button class="trending-tag">Travel</button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Main Section -->
<section class="main-content">
  <div class="container">
    <div class="filters-row">
      <div class="filter-buttons">
        <a href="?filter=all" class="btn filter-btn btn-outline{% if active_filter == 'all' %} active{% endif %}" data-filter="all">All</a>
        <a href="?filter=free" class="btn filter-btn btn-outline{% if active_filter == 'free' %} active{% endif %}" data-filter="free">Free</a>
        <a href="?filter=paid" class="btn filter-btn btn-outline{% if active_filter == 'paid' %} active{% endif %}" data-filter="paid">Paid</a>
      </div>

      <div class="filter-dropdowns">
        <form id="sortForm" method="get" style="display:inline;">
          <input type="hidden" name="filter" value="{{ active_filter }}" />
          <select id="sortFilter" name="sortFilter" onchange="document.getElementById('sortForm').submit();">
            <option value="date-desc" {% if active_sort == 'date-desc' %}selected{% endif %}>Date new to old</option>
            <option value="date-asc" {% if active_sort == 'date-asc' %}selected{% endif %}>Date old to new</option>
            <option value="price-asc" {% if active_sort == 'price-asc' %}selected{% endif %}>Price Low to High</option>
            <option value="price-desc" {% if active_sort == 'price-desc' %}selected{% endif %}>Price High to Low</option>
          </select>
        </form>
      </div>
    </div>

    <div class="section-header">
      <h3 class="section-title">Digital Artworks That Inspire</h3>
      <p class="section-subtitle">
        Download free or unlock exclusive premium designs, carefully crafted to
        elevate your digital world.
      </p>
    </div>

    {% csrf_token %}
    <div class="masonry-grid" id="masonryGrid">
      {% for image in images %}
      <div class="masonry-item">
      <a href="{% url 'image-detail' image.id %}">
          <img
            src="{{ image.original_image.url }}"
            alt="{{ image.alt_text }}"
            loading="lazy"
          />

          {% if image.is_paid %}
          <div class="price-banner">${{ image.image_price }}</div>
          {% endif %} {% if image.image_short_description %}
          <div class="image-description">
            {{ image.image_short_description }}
          </div>
          {% endif %}

          <div class="image-overlay">
            <div class="overlay-content">
              <div class="photographer">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="7" r="4"></circle>
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                </svg>
                <span>{{ image.author }}</span>
              </div>
              <div class="image-actions">
                {% if user.is_authenticated %}
                  {% if image.id in favorite_image_ids %}
                    <button class="action-btn like-btn" data-id="{{ image.id }}" onclick="toggleFavorite(event, this)" style="color: #ff4757;">
                      <i class="fa-solid fa-heart"></i>
                    </button>
                  {% else %}
                    <button class="action-btn like-btn" data-id="{{ image.id }}" onclick="toggleFavorite(event, this)">
                      <i class="fa-regular fa-heart"></i>
                    </button>
                  {% endif %}
                {% endif %}
                <button
                  class="action-btn download-btn"
                  data-id="{{ image.id }}"
                  onclick="event.preventDefault(); event.stopPropagation();"
                >
                  <i class="fa-solid fa-download"></i>
                </button>
              </div>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>

    <div id="loader" class="loader">
      <span></span><span></span><span></span>
    </div>
  </div>
</section>
<script src="{% static 'js/script.js' %}"></script>
{% endblock %} 
{% block extra_scripts %} 
<!-- Masonry + imagesLoaded -->
<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>

<script>
function toggleFavorite(event, button) {
    // Prevent the link from opening
    event.preventDefault();
    event.stopPropagation();
    
    const imageId = button.getAttribute('data-id');
    const heartIcon = button.querySelector('i');
    
    console.log('Toggle favorite clicked for image:', imageId);
    
    // Show loading state
    button.disabled = true;
    heartIcon.className = 'fa-solid fa-spinner fa-spin';
    
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
    if (!csrfToken) {
        console.error('CSRF token not found');
        showNotification('Security error. Please refresh the page.', 'error');
        return;
    }
    
    fetch('{% url "toggle_favorite" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': csrfToken.value
        },
        body: `image_id=${imageId}`
    })
    .then(response => {
        console.log('Response status:', response.status);
        return response.json();
    })
    .then(data => {
        console.log('Response data:', data);
        if (data.success) {
            // Toggle heart icon
            if (data.action === 'added') {
                heartIcon.className = 'fa-solid fa-heart';
                button.style.color = '#ff4757';
            } else {
                heartIcon.className = 'fa-regular fa-heart';
                button.style.color = '';
            }
            
            // Show subtle notification (no alert)
            showNotification(data.message, 'success');
        } else {
            showNotification(data.error || 'Something went wrong', 'error');
            // Reset to original state
            heartIcon.className = 'fa-regular fa-heart';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('Network error. Please try again.', 'error');
        heartIcon.className = 'fa-regular fa-heart';
    })
    .finally(() => {
        button.disabled = false;
    });
}

function showNotification(message, type) {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    
    // Style the notification
  let bgColor = '#2ed573';
  if (type === 'error' || message.toLowerCase().includes('removed from favorites')) {
    bgColor = '#ff4757';
  }
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${bgColor};
    color: white;
    padding: 12px 20px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    z-index: 10000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transform: translateX(100%);
    transition: transform 0.3s ease;
  `;
    
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}
</script>
{% endblock %}
